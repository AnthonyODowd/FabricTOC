# Identity and Chains of Trust

Identities really matter in a Hyperledger Fabric blockchain network! That's because a principal's **identity determines the exact permissions over resources in a blockchain network**. As well as **verifying** the information in a digital certificate, blockchain components who use a principal's identity also have to **recognize** the source of that trusted information. These two concepts -- verification and recognition -- combine to provide **trusted identities** in a blockchain network,  **Certificate Authorities** and **Membership Service Providers**.

## What is a Certificate Authority?

As you've seen, an identity is brought to the blockchain network by a principal in the form of a cryptographically validated digital certificate issued by a Certificate Authority (CA). CAs are a key part of the internet when it comes to security, and you've probably heard of some of the more popular ones: Symantec (originally Verisign), GeoTrust, DigiCert, GoDaddy, Comodo, and so on.  

The digital certificate provided by a CA for a principal incorporates the principal's public key, and a comprehensive set of their attributes. It is indeed elegant that CAs themselves have a certificate, which they make widely available, so that consumers of the CA's certificates can easily verify their origin. Consumers can verifying ceritificates from a CA by verifying that certificate hash could only have been generated by the holder of the corresponding private key -- the CA. (Remember that in modern systems, a private key is only ever held by a principal throughout the key's entire lifecycle, and CAs hold their private keys more securely than most.)

If you're interested, you can read a lot more about CAs [here](./), but for now you should think of them as the components who issue digital certificates that convey a principal's identity.

### Root CAs and Intermediate CAs

CAs come in two flavours: Root CAs and Intermediate CAs, and you've already seen some of the most popular **Root CAs** - Symantec, GeoTrust, etc. It's because Root CAs have to **securely distribute** hundreds of millions of certificates to internet users that it makes sense to distribute this process across many **Intermediate CAs**. These intermediate CAs provide their certificates under the authority of the Root CA, and this linkage between a Root CA and Intermediate CAs establishes a **Chain of Trust** for any certificate that is issued by any CA in the chain. This chain structure creates scale and security, and allows certificate consuming organizations to confidently use Intermediate CAs, because their identity has been signed by the trusted Root CA (or by a chain of Intermediate CAs which ultimately lead back to the Root CA). Ideally, you can see why it makes sense to limit the exposure of the Root CA -- compromising it would lead to destruction of the entire chain of trust - because a root CA is trusted by all. On the other hand, if an Intermediate CA is compromised, there is a much smaller exposure.

| ![ChainOfTrust](./IdentityandChainsofTrust.diagram.1.png) |
| :---: |
| A chain of trust is established between a Root CA and a set of Intermediate CAs using a simple chain. Many other configurations are possible to meet the needs of collaborating organizations. |

Intermediate CAs provide a huge amount of flexibility when it comes to the issuance of certificates across multiple organizations, and that's very helpful for a permissioned blockchain.  For example, you'll see that different organizations may use different RootCAs, or the same RootCA with different Intemediate CAs Many combinations possible. One Intermediate CA could exist for all orgs or every org can have its own Intermediate CA -- it really does depend on the needs of the network.

### Fabric CA

It's because CAs are so important that Hyperledger Fabric provides a built-in CA component to allow you to create CAs in the blockchain networks you form. You don't have to use the Fabric CA, but you will find it very helpful when you're starting to build a blockchain network for the first time, or using the [DRIVENET sample network](./).  

A Fabric CA is not as sophisticated as a full CA, but that's OK -- it's sufficient for many purposes. As you'll see, there are a few limitations to a Fabric CA. You can read more about these restrictions in the [Fabric CA reference section](../ReferenceMaterial/FabricCA.md)

## Membership Services Providers

You've now seen how CAs can provide verifiable identities through a chain of trust. However, there is more to forming a **trusted identity** than just being able to verify it -- the identity **has to be recognized**.  That's where Membership Services Providers (MSPs) come into play.

**You'll find the idea of an MSP easiest to understand if you start with an analogy.** Imagine that you're in a supermarket to buy some groceries. At the checkout you see a sign that says that Visa, Mastercard and AMEX cards are accepted. This means that you can only pay with a card that is recognized by the store.  If you try to pay with a different card -- ImagineCard for example -- it doesn't matter that the card is authentic, and you have sufficient funds -- it will not be accepted.  An MSP is like this list, except it's for CAs.  An MSP identifies which root CAs and intermediate CAs are recognized by the component using the MSP.  An MSP can also recognize other things related to identity -- for example identities that have been revoked -- but those things will be covered later.  For now, **think of an MSP as providing a recognition list for CAs**.

| ![MSPs](./IdentityandChainsofTrust.diagram.2.png) |
| :---: |
| A simplified configuration is shown here where the Network, Channel, Orderer and Peer only recognize identities issued by RCA1, RCA2, ICA1 and ICA2 respectively.  Network and channel MSPs are global, wheras peer and orderer MSPs are local. |

### Remainder material to be incorporated

So far, so good  -

well-known authorities who are the key parts of the internet, they provide  

 Network and Channel MSPs are global -- they control the behaviour of all nodes who interact with them.  Peer and Orderer MSPs are local -- they only control behaviour for the nodes where they are defined.  

Nothing about a Fabric network can function unless components trust each other's identities and the permissions those identities entitle them to. Establishing that trust means creating *digital certificates* which can be verified against a shared trust store of identities.

Those certificates are created by a component we call a Certificate Authority (CA) using public keys (which are self-generated from a component -- or user's -- public/private keys).

This is not dissimilar from how identity works in the real world. Think of your private key as being roughly analogous to a Social Security Number. It's too dangerous to expose directly as a regular form of identity, but it can be used to generate other identities -- a driver's license, for example -- which is issued by a trusted source (the DMV). This driver's license is like your public key -- still private, but used to grant permissions (like the right to drive) and to generate other identities (like a library card).

In a Fabric network, the CA -- which is trusted by the network -- takes the place of the DMV and issues you a digital cert. And just as the driver's license is used as a proxy for identity (while also conferring explicit privileges like the right to drive), the digital certs issued by a CA confer not just identity but rights to perform network functions or over network components.




*(Other things I'm not sure about: How are you brought into the network originally (how are those certs generated, from where, where are they stored, what happens to them). And then how are they used by you in two different ways: 1) to execute certain functions. How are they tested? Who tests them? Where do they test them? What exact identity are you using (is it a global ID or does it just go back to the root CA to check it). And 2) how is this identity used to get new privileges and how and where is that update stored (such that it can be checked out when you want to perform that action)).*











## MSPs in DRIVENET

## Material

You're now going to focus on four components the blockchain, and how they establish a **chain of trust** in order to help them determine which principals have permission over different network resources. As you saw in [](./),
In this topic, Four of the components in the network are

In this topic you'll see how **a chain of trust** must be established by four of the major components in a blockchain network -- the peers, orderers, channels and the network itself.

 -- they need to establish a chain of trust for the principals who wish to interact with these components.  

We  

For example, if a peer wants to determine whether a connected application can update a ledger, it uses the channel policy to look up the permission associated with the application's organization.

is a digital certificate which holds

As you've also seen, an identity is brought to the network by a principal in the form of a cryptographically validated digital certificate issued by a Certificate Authority.  Ad as we've seen, a Hyperledger Fabric blockhain network can only function when components trust principal's identities. There are two parts to establishing trust, specifically **digital certificates** and the identification of which can be verified against a shared trust store of identities.






[Next: Policies for Access Control](./PoliciesforAccessControl.md)
